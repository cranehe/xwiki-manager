<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>XEMServices</web>
<name>UserListDisplay</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.nfournier</author>
<customClass></customClass>
<contentAuthor>XWiki.nfournier</contentAuthor>
<creationDate>1180342442000</creationDate>
<date>1180692712000</date>
<contentUpdateDate>1180692712000</contentUpdateDate>
<version>1.61</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<name>tags</name>
<prettyName>Tags</prettyName>
<unmodifiable>0</unmodifiable>
<relationalStorage>1</relationalStorage>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<size>30</size>
<separator> </separator>
<cache>0</cache>
<separators> ,|</separators>
<values></values>
<number>1</number>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>XEMServices.UserListDisplay</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>## GET THE LETTER FILTER
## ---------------------
##set ($l_letter='A')
#set ($l_letter='')
#set ($f_letter='')
#if ($request.lletter)
  #if($request.lletter=='all')
    #set ($l_letter='%')
  #else
    #set ($l_letter=$request.lletter)
  #end
#end
#if ($request.fletter)
  #set ($f_letter=$request.fletter)
#end
## GET THE XWIKI USERS
## -------------------
#set ($sql = ", BaseObject as obj, StringProperty as last, StringProperty as first where obj.name=doc.fullName and obj.className='XWiki.XWikiUsers' and obj.id=last.id.id and obj.id=first.id.id and last.id.name='last_name' and first.id.name='first_name' and last.value like '$l_letter%' and first.value like '$f_letter%' order by last.value")
#if($l_letter=='')
	#if($xwiki.searchDocuments($sql).size()&gt;50)
		#set ($sql2 = ", BaseObject as obj, StringProperty as last, StringProperty as first where obj.name=doc.fullName and obj.className='XWiki.XWikiUsers' and obj.id=last.id.id and obj.id=first.id.id and last.id.name='last_name' and first.id.name='first_name' and last.value like 'A%' and first.value like '$f_letter%' order by last.value")
	#else
		#set ($sql2 = ", BaseObject as obj, StringProperty as last, StringProperty as first where obj.name=doc.fullName and obj.className='XWiki.XWikiUsers' and obj.id=last.id.id and obj.id=first.id.id and last.id.name='last_name' and first.id.name='first_name' and last.value like '%' and first.value like '$f_letter%' order by last.value")
	#end
#else
	#set($sql2 = $sql)
#end
##  DISPLAY THEM
## -------------
#set ($aList = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"])
&lt;div&gt;
    #if($l_letter=="%")
    	A-Z
    #else
    	&lt;a href="" onclick="updateUserList('userList1', 'all');return false;"&gt;A-Z&lt;/a&gt;
    #end
    #foreach ($letter in $aList)
    	#if($l_letter!=$letter)
        	&lt;a href="" onclick="updateUserList('userList1', '$letter');return false;"&gt;$letter&lt;/a&gt;
        #else
        	$letter
        #end
    #end
&lt;/div&gt;
&lt;div&gt;
	&lt;a href="" onclick="checkAllBox('checkuser');return false;"&gt;$msg.get("checkall")&lt;/a&gt; | &lt;a href="" onclick="uncheckAllBox('checkuser');return false;"&gt;$msg.get("uncheckall")&lt;/a&gt;
&lt;/div&gt;

#*
&lt;table width="100%" style="border:1px solid;" class="xem_userlisttable"&gt;
	#if($xwiki.searchDocuments($sql2).size()!=0)
		#foreach ($item in $xwiki.searchDocuments($sql2))
		#set($user=$xwiki.getDocument($item))
		&lt;tr id="${user.fullName}_tr"&gt;
	        &lt;td width="25%" class="unsortable noFilter"&gt;&lt;input type="checkbox" name="checkuser" id="$user.fullName"/&gt;&lt;/td&gt;
	        &lt;td width="25%"&gt;
	        	$user.display("last_name")
	        	&lt;input type="hidden" id="${user.fullName}_last_name" value="$user.display("last_name")" /&gt;
	        &lt;/td&gt;
	        &lt;td width="25%"&gt;
	        	$user.display("first_name")
	        	&lt;input type="hidden" id="${user.fullName}_first_name" value="$user.display("first_name")" /&gt;
	        &lt;/td&gt;
	        &lt;td width="25%"&gt;
	        	$user.display("email")
	        	&lt;input type="hidden" id="${user.fullName}_email" value="$user.display("email")" /&gt;
	        &lt;/td&gt;
	    &lt;/tr&gt;
		#end
	#end
&lt;/table&gt;
*#

&lt;table id="searchTableUnique" class="grid sortable doOddEven" cellSpacing=0 cellpadding="0" border="1"&gt;
 &lt;tr class="sortHeader"&gt;
    &lt;th width="24"&gt;$msg.get("selection")&lt;/th&gt;
    &lt;th width="150" class="selectFilter"&gt;$msg.get("last_name")&lt;/th&gt;
    &lt;th width="150"&gt;$msg.get("first_name")&lt;/th&gt;
    &lt;th width="150"&gt;$msg.get("email")&lt;/th&gt;
  &lt;/tr&gt;
  #foreach ($item in $xwiki.searchDocuments($sql2))
    #set($user=$xwiki.getDocument($item))
      &lt;tr id="${user.fullName}_tr"&gt;
        &lt;td align=left&gt;&lt;input type="checkbox" name="checkuser" id="$user.fullName"/&gt;&lt;/td&gt;
        &lt;td align=left&gt;$user.display("last_name")
	        	&lt;input type="hidden" id="${user.fullName}_last_name" value="$user.display("last_name")" /&gt;&lt;/td&gt;
        &lt;td align=left&gt;$user.display("first_name")
	        	&lt;input type="hidden" id="${user.fullName}_first_name" value="$user.display("first_name")" /&gt;&lt;/td&gt;
        &lt;td align=left&gt;$user.display("email")
	        	&lt;input type="hidden" id="${user.fullName}_email" value="$user.display("email")" /&gt;&lt;/td&gt;
      &lt;/tr&gt;
  #end
&lt;/table&gt;
</content></xwikidoc>