<?xml version="1.0" encoding="ISO-8859-1"?>

<xwikidoc>
<web>WikiDirectory</web>
<name>CreateNewWiki</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.nfournier</author>
<customClass></customClass>
<contentAuthor>XWiki.nfournier</contentAuthor>
<creationDate>1180096174000</creationDate>
<date>1180693736000</date>
<contentUpdateDate>1180693736000</contentUpdateDate>
<version>1.115</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<object>
<class>
<name>XWiki.XWikiRights</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<groups>
<name>groups</name>
<prettyName>Groups</prettyName>
<unmodifiable>0</unmodifiable>
<relationalStorage>0</relationalStorage>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<size>5</size>
<separator> </separator>
<cache>0</cache>
<usesList>1</usesList>
<number>4</number>
<classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
</groups>
<users>
<name>users</name>
<prettyName>Users</prettyName>
<unmodifiable>0</unmodifiable>
<relationalStorage>0</relationalStorage>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<size>5</size>
<separator> </separator>
<cache>0</cache>
<usesList>1</usesList>
<number>4</number>
<classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
</users>
<levels>
<name>levels</name>
<prettyName>Levels</prettyName>
<unmodifiable>0</unmodifiable>
<relationalStorage>0</relationalStorage>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<size>3</size>
<separator> </separator>
<cache>0</cache>
<number>4</number>
<classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
</levels>
<allow>
<name>allow</name>
<prettyName>Allow/Deny</prettyName>
<unmodifiable>0</unmodifiable>
<displayFormType>select</displayFormType>
<defaultValue>1</defaultValue>
<displayType>allow</displayType>
<number>4</number>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</allow>
</class>
<name>WikiDirectory.CreateNewWiki</name>
<number>0</number>
<className>XWiki.XWikiRights</className>
<property>
<groups></groups>
</property>
<property>
<users></users>
</property>
<property>
<levels></levels>
</property>
<property>
<allow>1</allow>
</property>
</object>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<name>tags</name>
<prettyName>Tags</prettyName>
<unmodifiable>0</unmodifiable>
<relationalStorage>1</relationalStorage>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<size>30</size>
<separator> </separator>
<cache>0</cache>
<separators> ,|</separators>
<values></values>
<number>1</number>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>WikiDirectory.CreateNewWiki</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>1 $msg.get("createwiki")

#set($wikiname = $request.getParameter("wikiname"))
#set($domainname = "localdomain.com")
#set($defaultwiki = "xwikidefaulten")
#set($created=0)

#if($wikiname)
	#set($result = $context.xWiki.createNewWiki($wikiname, "${wikiname}.${domainname}", $context.user, $defaultwiki, true))
	
	#if($result==1)
		#set($created=1)
	#else
		&lt;font color=red&gt;
		#if ($result==-5)
			This wiki already exist. Please choose another name.
		#elseif ($result==-3)
				Your account is not yet active. An email has been sent to you during the registration process to allow you to activate it. If you did not receive this email please contact the [support&gt;Support.WebHome].
		#else
			An error occured while creating your wiki(code $result).
		#end
                &lt;/font&gt;
	#end
#end

#if($created==0)
&lt;style&gt;

.xem_userlisttable td {
}

&lt;/style&gt;

&lt;form method="get" name="createwiki"&gt;
     &lt;table width="100%"&gt;
		&lt;tr&gt;
			&lt;td&gt;$msg.get("wikiname") &lt;/td&gt;
			&lt;td&gt;&lt;input type="text" name="wikiname" id="wikiname" /&gt;&lt;/td&gt;
			&lt;td id="wikinameerrormsg" width="40%"&gt;&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td&gt;$msg.get("wikidesc")&lt;/td&gt;
			&lt;td&gt;&lt;input type="text" name="wikidesc" id="wikidesc" /&gt;&lt;/td&gt;
			&lt;td id="wikidescerrormsg" width="40%"&gt;&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td&gt;$msg.get("wikiadmin")&lt;/td&gt;
			&lt;td&gt;&lt;select name="wikiadmin" id="wikiadmin"&gt;&lt;option value=""&gt;---&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
			&lt;td id="wikiadminerrormsg" width="40%"&gt;&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td&gt;$msg.get("wikitemplate")&lt;/td&gt;
			&lt;td&gt;&lt;select name="wikitemplate" id="wikitemplate"&gt;&lt;option value=""&gt;---&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
			&lt;td id="wikitemplateerrormsg" width="40%"&gt;&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td&gt;$msg.get("wikivisibility")&lt;/td&gt;
			&lt;td&gt;&lt;select name="wikivisibility" id="wikivisibility"&gt; &lt;option value=""&gt;---&lt;/option&gt;&lt;/select&gt;&lt;/td&gt;
			&lt;td id="wikivisibilityerrormsg" width="40%"&gt;&lt;/td&gt;
		&lt;/tr&gt;
    &lt;/table&gt;
    &lt;br/&gt;
    &lt;table width="100%" cellpadding="10px" cellspacing="10px"&gt;
		&lt;tr&gt;
			&lt;td style="vertical-align:top;"&gt;
				&lt;div id="userList1"&gt;
					#includeInContext("XEMServices.UserListDisplay")
				&lt;/div&gt;  
			&lt;/td&gt;
			&lt;td&gt;
				&lt;span class="buttonwrapper" style="cursor:pointer;"&gt;&lt;a onclick="addSelectedUsersToList('checkuser')"&gt;$msg.get("addselectedusertolist")&lt;/a&gt;&lt;/span&gt;
			&lt;/td&gt;
			&lt;td style="vertical-align:top;"&gt;
                &lt;div&gt;
                	&lt;a href="" onclick="checkAllBox('checkuserselected');return false;"&gt;$msg.get("checkall")&lt;/a&gt; | &lt;a href="" onclick="uncheckAllBox('checkuserselected');return false;"&gt;$msg.get("uncheckall")&lt;/a&gt;
                &lt;/div&gt;
                &lt;table width="100%" style="border:1px solid;" id="userList2"&gt;
                         
		&lt;/table&gt;
            &lt;/td&gt;
		&lt;/tr&gt;
	&lt;/table&gt;
	&lt;span class="buttonwrapper" style="cursor:pointer;"&gt;&lt;a onclick="validCreateWikiForm()"&gt;$msg.get("submitlabel")&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;
&lt;input type="submit" value="test de creation"&gt;
&lt;/form&gt;
#else
	Your wiki has been created. You can access your wiki at the following address: 

	http://${wikiname}.${domainname}
#end

</content></xwikidoc>